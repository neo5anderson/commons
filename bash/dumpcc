#!/bin/bash
# 生成空白头文件和实现
#
#   dumpcc new_file_name
#

script_name=`basename $0`

if [ -z "$1" ]; then
    echo "usage: $script_name new_file_name"
    exit 1
fi

cpwd=`pwd`
folder=`dirname $1`
folder_name=${folder#${cpwd}/}

target=`basename $1`
target_name=${target%.*}

if [ "$folder_name" = "." ]; then
    header_name=${target_name}.h
    upper_name=`echo ${target_name} | tr ['a-z'] ['A-Z']`
else
    if [ ! -d $folder_name ]; then
        mkdir -p $folder_name
    fi
    header_name=${folder_name}/${target_name}.h
    upper_name=`echo ${folder_name}_${target_name} | tr ['a-z'] ['A-Z']`
fi

if [ -f ${target_name}.h* ]; then
    echo "$target_name header has exist!"
    exit 2
fi

if [ -f ${target_name}.c* ]; then
    echo "$target_name impl has exist!"
    exit 2
fi

cat > ${folder_name}/${target_name}.h <<CC_HEADER
// Generated by Neo

#ifndef _${upper_name}_H_
#define _${upper_name}_H_

// TODO: includes here


#ifdef __cplusplus
extern "C" {
#endif

// TODO: defination here


#ifdef __cplusplus
}
#endif

#endif /* _${upper_name}_H_ */

CC_HEADER

cat > ${folder_name}/${target_name}.cc <<CC_IMPL
// Generated by Neo

#include "${header_name}"

// TODO: impl here

CC_IMPL

